<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat-room.css') }}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Raleway:wght@500;700&display=swap"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap"/>
  
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  </head>
  <body>
    <div class="chat-room">
      <div class="wrapper4">
        <a class="a6">èŠå¤©å®¤</a>
      </div>
      <main class="chatroom-content">
        <section class="chat">
          <div class="chat-components">
            <div class="profile1">
              <div class="profile-components">
                <div class="button">
                  <h1 class="h12">æƒ…æ„Ÿåˆ†æå€</h1>
                </div>
              </div>
              <div class="profile-child"></div>
              <div class="list-parent">
                <div class="list">
                  <div class="menu-item">
                    <img
                      class="search-icon"
                      loading="lazy"
                      alt=""
                      src="{{url_for('static', filename='image/search.svg')}}"
                    />

                    <div class="div14">æœå°‹</div>
                  </div>
                  <div class="menu-item1">
                    <img class="image-icon" alt="" src="{{url_for('static', filename='image/image.svg')}}" />

                    <div class="div15">å‚³é€åœ–ç‰‡</div>
                  </div>
                  <div class="menu-item2">
                    <img
                      class="more-horizontal-icon"
                      alt=""
                      src="{{url_for('static', filename='image/morehorizontal.svg')}}"
                    />

                    <div class="div16">æ›´å¤š</div>
                  </div>
                </div>
                <div class="person-wrapper">
                  <div class="person">
                    <div class="avatar-wrapper">
                      <img
                        class="avatar-icon"
                        loading="lazy"
                        alt=""
                        src="{{url_for('static', filename='image/avatar@2x.png')}}"
                      />
                    </div>
                    <div class="name-status">
                      <div class="helena">Helena</div>
                      <div class="div17">20åˆ†é˜å‰ä¸Šç·š</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="list1">
              <div class="chat-list-header">
                <h1 class="h13">èŠå¤©åˆ—è¡¨</h1>
              </div>
              <div class="chat-list-search">
                <div class="search-bar">
                  <div class="search1">
                    <img
                      class="search-icon1"
                      alt=""
                      src="{{url_for('static', filename='image/search-1.svg')}}"
                    />

                    <input class="label" placeholder="æœå°‹" type="text" />
                  </div>
                </div>
                <div class="chat-list">
                  <div class="conversation">
                    <img
                      class="avatar-icon1"
                      loading="lazy"
                      alt=""
                      src="{{url_for('static', filename='image/avatar-1@2x.png')}}"
                    />

                    <div class="conversation-preview">
                      <div class="text">
                        <div class="helena-hills">Helena Hills</div>
                        <div class="will-head-to">
                          Will head to the Help Center...
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation1">
                    <div class="avatar">
                      <img
                        class="avatar-child"
                        loading="lazy"
                        alt=""
                        
                        src="{{url_for('static', filename='image/rectangle-1@2x.png')}}"
                      />
                    </div>
                    <div class="text-wrapper">
                      <div class="text1">
                        <div class="oscar-davis">Oscar Davis</div>
                        <div class="trueeeeee">Trueeeeee</div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation2">
                    <img
                      class="avatar-icon2"
                      alt=""
                      
                      src="{{url_for('static', filename='image/avatar-2@2x.png')}}"
                      />

                    <div class="text-container">
                      <div class="text2">
                        <div class="daniel-jay-park">Daniel Jay Park</div>
                        <div class="lol-yeah-are">
                          lol yeah, are you coming to the lunch on the 13th?
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation3">
                    <img
                      class="avatar-icon3"
                      alt=""
                      
                      src="{{url_for('static', filename='image/avatar-3@2x.png')}}"
                    />

                    <div class="text-frame">
                      <div class="text3">
                        <div class="mark-rojas">Mark Rojas</div>
                        <div class="great-catching-up">
                          great catching up over dinner!!
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation4">
                    <img
                      class="avatar-icon4"
                      loading="lazy"
                      alt=""
                      src="{{url_for('static', filename='image/avatar-4@2x.png')}}"
                    />

                    <div class="text-wrapper1">
                      <div class="text4">
                        <div class="giannis-constantinou">
                          Giannis Constantinou
                        </div>
                        <div class="yep">yep ğŸ«¡ğŸ«¡</div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation5">
                    <img
                      class="avatar-icon5"
                      loading="lazy"
                      alt=""
                      src="{{url_for('static', filename='image/avatar-5@2x.png')}}"
                    />

                    <div class="text-wrapper2">
                      <div class="text5">
                        <div class="briana-lewis">Briana Lewis</div>
                        <div class="when-are-you">
                          When are you coming back to town? Would love to catch
                          up.
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation6">
                    <img
                      class="avatar-icon6"
                      loading="lazy"
                      alt=""
                      
                      src="{{url_for('static', filename='image/avatar-6@2x.png')}}"
                    />

                    <div class="text-wrapper3">
                      <div class="text6">
                        <div class="mom">Mom</div>
                        <div class="thanks">Thanks!</div>
                      </div>
                    </div>
                  </div>
                  <div class="conversation7">
                    <img
                      class="avatar-icon7"
                      loading="lazy"
                      alt=""
                      
                      src="{{url_for('static', filename='image/avatar-7@2x.png')}}"
                    />

                    <div class="text-wrapper4">
                      <div class="text7">
                        <div class="sherry-roy">Sherry Roy</div>
                        <div class="jack-needs-to">
                          Jack needs to find a sitter for the dog and I donâ€™t
                          know whoâ€™s good
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="conversation8">
            <div class="chat-header">
              <div class="person1">
                <img
                  class="avatar-icon8"
                  loading="lazy"
                  alt=""
                  
                  src="{{url_for('static', filename='image/avatar-8@2x.png')}}"
                />

                <div class="text8">
                  <div class="helena-hills1">Helena Hills</div>
                  <div class="div18">20åˆ†é˜å‰ä¸Šç·š</div>
                </div>
              </div>
              <div class="call-icons">
                <div class="icons">
                  <img
                    class="phone-icon"
                    loading="lazy"
                    alt=""
                    src="{{url_for('static', filename='image/phone.svg')}}"
                  />

                  <img
                    class="video-icon"
                    loading="lazy"
                    alt=""
                    src="{{url_for('static', filename='image/video.svg')}}"
                  />
                </div>
              </div>
            </div>
            
            <div class="messages-parent" style="height: 500px; overflow-y: auto;">
              <div class="messages">
                  
              </div>
            </div>

            <div class="reply">
                <input type="text" class="label1" placeholder="Enter your message" />
                <img class="mic-icon" loading="lazy" alt="" src="{{url_for('static', filename='image/mic.svg')}}" />
                <img class="smile-icon" loading="lazy" alt="" src="{{url_for('static', filename='image/smile.svg')}}" />
                <img class="image-icon1" loading="lazy" alt="" src="{{url_for('static', filename='image/image-1.svg')}}" />
            </div>
            
            </div>
          </div>
        </section>
        <div class="analysis-area">
          <div class="analysis-content">
            <a class="a7">æƒ…æ„Ÿåˆ†æå€</a>
          </div>
          <div class="analysis-input">
            <div class="analysis-input-child"></div>
            <h1 class="h14">
              è¼¸å…¥æˆ–ä¸Šå‚³èŠå¤©å°è©±è®“æˆ‘å€‘å¹«åŠ©ä½ åˆ†æå°æ–¹çš„æƒ…æ„Ÿç‹€æ…‹
            </h1>
            <div class="analysis-button">
              <div class="run-analysis" id="runAnalysisContainer">
                <h1 class="h15">åˆ†æ</h1>
              </div>
            </div>
          </div>
        </div>
      </main>
      <div class="background"></div>
    </div>

    <script>
      var runAnalysisContainer = document.getElementById("runAnalysisContainer");
      if (runAnalysisContainer) {
        runAnalysisContainer.addEventListener("click", function (e) {
          window.location.href = "./sentiment-analysis.html";
        });
      }
      
    </script>
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function() {
          var socket = io.connect('http://' + document.domain + ':' + location.port);
  
          // ç•¶ç”¨æˆ¶é€£æ¥æ™‚è§¸ç™¼
          socket.on('connect', function() {
              console.log('Connected');
          });
  
          // ç•¶æ”¶åˆ°æ¶ˆæ¯æ™‚è§¸ç™¼
          socket.on('message', function(msg) {
              displayMessage(msg, 'contact-messages');
          });
  
          // ç™¼é€æ¶ˆæ¯
          var messageInput = document.querySelector('.label1');
          messageInput.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                  e.preventDefault(); // é˜²æ­¢é»˜èªçš„æäº¤è¡Œç‚º
                  var msg = messageInput.value;
                  if (msg.trim() !== "") { // ç¢ºä¿æ¶ˆæ¯ä¸ç‚ºç©º
                      socket.send(msg);
                      displayMessage(msg, 'user-messages');
                      messageInput.value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
                  }
              }
          });
  
          // é¡¯ç¤ºæ¶ˆæ¯
          function displayMessage(msg, messageType) {
            var messages = document.querySelector('.messages');
            var newMessage = document.createElement('div');
            newMessage.classList.add('bubble');
            newMessage.innerHTML = `
                <div class="${messageType}">
                  <div class="message-content">${msg}</div>
                  <div class="timestamp">${formatTimeOnly(new Date())}</div>
                </div>`;
            messages.appendChild(newMessage);

            //if (messagesContainer.children.length > 8) {
            //  messagesContainer.removeChild(messagesContainer.children[0]);
            //}

            messages.scrollTop = messages.scrollHeight; // æ»¾å‹•åˆ°æœ€æ–°æ¶ˆæ¯
          }
          function formatTimeOnly(date) {
            let hours = date.getHours();
            let minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'ä¸‹åˆ' : 'ä¸Šåˆ';
            hours = hours % 12;
            hours = hours ? hours : 12; // å°‡ 0 è½‰æ›ç‚º 12
            minutes = minutes < 10 ? '0' + minutes : minutes;
            return `${ampm} ${hours}:${minutes}`;
          }
      })
  </script>
  <!--script
    const MAX_VISIBLE_MESSAGES = 15;
    let allMessages = [];
    const messagesContainer = document.querySelector('.messages');
    const messagesParent = document.querySelector('.messages-parent');
    
    function addNewMessage(message) {
        allMessages.push(message);
        const messageElement = createMessageElement(message);
        messagesContainer.appendChild(messageElement);
        
        // å¦‚æœè¨Šæ¯æ•¸é‡è¶…éé™åˆ¶,åˆªé™¤æœ€èˆŠçš„è¨Šæ¯
        if (allMessages.length > MAX_VISIBLE_MESSAGES) {
            allMessages.shift();
            messagesContainer.removeChild(messagesContainer.firstChild);
        }
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        scrollToBottom();
    }
    
    function createMessageElement(message) {
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        
        // æ ¹æ“šè¨Šæ¯é¡å‹è¨­ç½®ä¸åŒçš„æ¨£å¼
        if (message.isUser) {
            bubble.classList.add('user-messages');
        } else {
            bubble.classList.add('contact-messages');
        }
        
        const content = document.createElement('div');
        content.textContent = message.text;
        bubble.appendChild(content);
        
        return bubble;
    }
    
    function scrollToBottom() {
        messagesParent.scrollTop = messagesParent.scrollHeight;
    }
    
    // æ¨¡æ“¬æ¥æ”¶æ–°è¨Šæ¯çš„å‡½æ•¸ (å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰æ›¿æ›ç‚ºçœŸå¯¦çš„è¨Šæ¯æ¥æ”¶é‚è¼¯)
    function simulateNewMessage(text, isUser) {
        addNewMessage({ text, isUser });
    }
    
    // åˆå§‹åŒ–ä¸€äº›è¨Šæ¯
    for (let i = 1; i <= 10; i++) {
        simulateNewMessage(`åˆå§‹è¨Šæ¯ ${i}`, i % 2 === 0);
    }
    
    // æ¸¬è©¦: æ¯3ç§’æ·»åŠ ä¸€æ¢æ–°è¨Šæ¯
    setInterval(() => {
        simulateNewMessage(`æ–°è¨Šæ¯ ${new Date().toLocaleTimeString()}`, Math.random() > 0.5);
    }, 3000);
    
    </script>
  -->
  </body>
</html>
